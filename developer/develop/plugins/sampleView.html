<!DOCTYPE html>
<html>
    <head>
        <title>
            Sample view
        </title>

        <meta http-equiv="content-type" content="text/html; charset=utf-8"/>

        <link href="../../_static/copybutton.css" rel="stylesheet" type="text/css" />
        <link href="../../_static/pygments.css" rel="stylesheet" type="text/css" />
        <link href="../../_static/tabs.css" rel="stylesheet" type="text/css" />
        <link href="../../_static/theme.css" rel="stylesheet" type="text/css" />
                <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
                <script src="../../_static/jquery.js"></script>
                <script src="../../_static/underscore.js"></script>
                <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
                <script src="../../_static/doctools.js"></script>
                <script src="../../_static/clipboard.min.js"></script>
                <script src="../../_static/copybutton.js"></script>
                <script src="../../_static/tabs.js"></script>

        <script src="../../_static/theme.js" type="text/javascript"></script>

        <link href="../../_static/katex/katex.min.css" rel="stylesheet" type="text/css"/>

        <script defer src="../../_static/katex/katex.min.js" type="text/javascript"></script>
        <script defer src="../../_static/katex/contrib/auto-render.min.js" type="text/javascript" onload="renderMathInElement(document.body);"></script>
    </head>
    <body ondragstart="return false;" ondrop="return false;">
        
  <section id="sample-view">
<span id="develop-plugins-sampleview"></span><h1>Sample view<a class="headerlink" href="#sample-view" title="Permalink to this heading">¶</a></h1>
<p>The purpose of this plugin is to provide a view that gives some information about the current file.</p>
<section id="file-structure">
<h2>File structure<a class="headerlink" href="#file-structure" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>i18n
 └─ SampleView_fr.ts
res
 └─ SampleView_i18n.qrc.in
src
 ├─ sampleviewplugin.cpp
 ├─ sampleviewplugin.h
 ├─ sampleviewplugin.json
 ├─ sampleviewwidget.cpp
 ├─ sampleviewwidget.h
 └─ sampleviewwidget.ui
CMakeLists.txt
</pre></div>
</div>
</section>
<section id="category">
<h2>Category<a class="headerlink" href="#category" title="Permalink to this heading">¶</a></h2>
<p>Our plugin is part of the <a class="reference external" href="https://github.com/opencor/opencor/tree/master/src/plugins/sample/">Sample</a> category, which means that its code can be found under <a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleView/"><code class="docutils literal notranslate"><span class="pre">[OpenCOR]/src/plugins/sample/SampleView/</span></code></a>.</p>
</section>
<section id="interfaces">
<h2>Interfaces<a class="headerlink" href="#interfaces" title="Permalink to this heading">¶</a></h2>
<p>We want our plugin to interact with OpenCOR.
This means that it needs to implement some <a class="reference internal" href="index.html#develop-plugins-index-interfaces"><span class="std std-ref">interfaces</span></a>.</p>
<p>More specifically, we want our plugin to be a view, so we need to implement both the <a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/plugininterface.inl">Plugin</a> and <a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/viewinterface.inl">View</a> interfaces.
Considering the purpose of our plugin, we also need to implement the <a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/filehandlinginterface.inl">File handling</a> interface.
While we are at it, we might also internationalise our plugin, which means also implementing the <a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/i18ninterface.inl">Internationalisation</a> interface.</p>
</section>
<section id="cmake-project">
<h2>CMake project<a class="headerlink" href="#cmake-project" title="Permalink to this heading">¶</a></h2>
<p>As for the <a class="reference internal" href="sample.html#develop-plugins-sample"><span class="std std-ref">Sample</span></a> plugin, our plugin has a <a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleView/CMakeLists.txt"><code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code></a> file, which contents is:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="lineno"> 1 </span><span class="nb">project</span><span class="p">(</span><span class="s">SampleViewPlugin</span><span class="p">)</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="c"># Add the plugin</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="nb">add_plugin</span><span class="p">(</span><span class="s">SampleView</span>
<span class="lineno"> 6 </span>    <span class="s">SOURCES</span>
<span class="lineno"> 7 </span>        <span class="s">../../filehandlinginterface.cpp</span>
<span class="lineno"> 8 </span>        <span class="s">../../i18ninterface.cpp</span>
<span class="lineno"> 9 </span>        <span class="s">../../plugininfo.cpp</span>
<span class="lineno">10 </span>        <span class="s">../../plugininterface.cpp</span>
<span class="lineno">11 </span>        <span class="s">../../viewinterface.cpp</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span>        <span class="s">src/sampleviewplugin.cpp</span>
<span class="lineno">14 </span>        <span class="s">src/sampleviewwidget.cpp</span>
<span class="lineno">15 </span>    <span class="s">UIS</span>
<span class="lineno">16 </span>        <span class="s">src/sampleviewwidget.ui</span>
<span class="lineno">17 </span>    <span class="s">PLUGINS</span>
<span class="lineno">18 </span>        <span class="s">Core</span>
<span class="lineno">19 </span><span class="p">)</span>
</pre></div>
</div>
<p>The interfaces our plugin implements come with a <code class="docutils literal notranslate"><span class="pre">.cpp</span></code> file, so we reference them (lines 7, 8, 10 and 11).
Then, our plugin needs the <a class="reference external" href="https://github.com/opencor/opencor/tree/master/src/plugins/miscellaneous/Core/">Core</a> plugin, so it is referenced (line 18) using the <code class="docutils literal notranslate"><span class="pre">PLUGINS</span></code> keyword (line 17).
Our plugin provides OpenCOR with a test view, which is implemented using various files (lines 14 and 16).
One of those files is a <code class="docutils literal notranslate"><span class="pre">.ui</span></code> file, which is referenced using the <code class="docutils literal notranslate"><span class="pre">UIS</span></code> keyword (line 15).</p>
</section>
<section id="plugin-information">
<h2>Plugin information<a class="headerlink" href="#plugin-information" title="Permalink to this heading">¶</a></h2>
<p>Our <a class="reference internal" href="index.html#develop-plugins-index-plugininformation"><span class="std std-ref">plugin information</span></a> can be found in <a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleView/src/sampleviewplugin.cpp"><code class="docutils literal notranslate"><span class="pre">sampleviewplugin.cpp</span></code></a>, <a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleView/src/sampleviewplugin.h"><code class="docutils literal notranslate"><span class="pre">sampleviewplugin.h</span></code></a> and <a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleView/src/sampleviewplugin.json"><code class="docutils literal notranslate"><span class="pre">sampleviewplugin.json</span></code></a>.
Starting with <a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleView/src/sampleviewplugin.h"><code class="docutils literal notranslate"><span class="pre">sampleviewplugin.h</span></code></a>, its contents is:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="lineno">28 </span><span class="cp">#include</span> <span class="cpf">&quot;filehandlinginterface.h&quot;</span><span class="cp"></span>
<span class="lineno">29 </span><span class="cp">#include</span> <span class="cpf">&quot;i18ninterface.h&quot;</span><span class="cp"></span>
<span class="lineno">30 </span><span class="cp">#include</span> <span class="cpf">&quot;plugininfo.h&quot;</span><span class="cp"></span>
<span class="lineno">31 </span><span class="cp">#include</span> <span class="cpf">&quot;plugininterface.h&quot;</span><span class="cp"></span>
<span class="lineno">32 </span><span class="cp">#include</span> <span class="cpf">&quot;viewinterface.h&quot;</span><span class="cp"></span>
<span class="lineno">33 </span>
<span class="lineno">34 </span><span class="c1">//==============================================================================</span>
<span class="lineno">35 </span>
<span class="lineno">36 </span><span class="k">namespace</span> <span class="n">OpenCOR</span> <span class="p">{</span>
<span class="lineno">37 </span><span class="k">namespace</span> <span class="n">SampleView</span> <span class="p">{</span>
<span class="lineno">38 </span>
<span class="lineno">39 </span><span class="c1">//==============================================================================</span>
<span class="lineno">40 </span>
<span class="lineno">41 </span><span class="n">PLUGININFO_FUNC</span> <span class="n">SampleViewPluginInfo</span><span class="p">();</span>
<span class="lineno">42 </span>
<span class="lineno">43 </span><span class="c1">//==============================================================================</span>
<span class="lineno">44 </span>
<span class="lineno">45 </span><span class="k">class</span> <span class="nc">SampleViewWidget</span><span class="p">;</span>
<span class="lineno">46 </span>
<span class="lineno">47 </span><span class="c1">//==============================================================================</span>
<span class="lineno">48 </span>
<span class="lineno">49 </span><span class="k">class</span> <span class="nc">SampleViewPlugin</span> <span class="o">:</span> <span class="k">public</span> <span class="n">QObject</span><span class="p">,</span> <span class="k">public</span> <span class="n">FileHandlingInterface</span><span class="p">,</span>
<span class="lineno">50 </span>                         <span class="k">public</span> <span class="n">I18nInterface</span><span class="p">,</span> <span class="k">public</span> <span class="n">PluginInterface</span><span class="p">,</span>
<span class="lineno">51 </span>                         <span class="k">public</span> <span class="n">ViewInterface</span>
<span class="lineno">52 </span><span class="p">{</span>
<span class="lineno">53 </span>    <span class="n">Q_OBJECT</span>
<span class="lineno">54 </span>
<span class="lineno">55 </span>    <span class="n">Q_PLUGIN_METADATA</span><span class="p">(</span><span class="n">IID</span> <span class="s">&quot;OpenCOR.SampleViewPlugin&quot;</span> <span class="kt">FILE</span> <span class="s">&quot;sampleviewplugin.json&quot;</span><span class="p">)</span>
<span class="lineno">56 </span>
<span class="lineno">57 </span>    <span class="n">Q_INTERFACES</span><span class="p">(</span><span class="n">OpenCOR</span><span class="o">::</span><span class="n">FileHandlingInterface</span><span class="p">)</span>
<span class="lineno">58 </span>    <span class="n">Q_INTERFACES</span><span class="p">(</span><span class="n">OpenCOR</span><span class="o">::</span><span class="n">I18nInterface</span><span class="p">)</span>
<span class="lineno">59 </span>    <span class="n">Q_INTERFACES</span><span class="p">(</span><span class="n">OpenCOR</span><span class="o">::</span><span class="n">PluginInterface</span><span class="p">)</span>
<span class="lineno">60 </span>    <span class="n">Q_INTERFACES</span><span class="p">(</span><span class="n">OpenCOR</span><span class="o">::</span><span class="n">ViewInterface</span><span class="p">)</span>
<span class="lineno">61 </span>
<span class="lineno">62 </span><span class="k">public</span><span class="o">:</span>
<span class="lineno">63 </span>    <span class="k">explicit</span> <span class="n">SampleViewPlugin</span><span class="p">();</span>
<span class="lineno">64 </span>
<span class="lineno">65 </span><span class="cp">#include</span> <span class="cpf">&quot;filehandlinginterface.inl&quot;</span><span class="cp"></span>
<span class="lineno">66 </span><span class="cp">#include</span> <span class="cpf">&quot;i18ninterface.inl&quot;</span><span class="cp"></span>
<span class="lineno">67 </span><span class="cp">#include</span> <span class="cpf">&quot;plugininterface.inl&quot;</span><span class="cp"></span>
<span class="lineno">68 </span><span class="cp">#include</span> <span class="cpf">&quot;viewinterface.inl&quot;</span><span class="cp"></span>
<span class="lineno">69 </span>
<span class="lineno">70 </span><span class="k">private</span><span class="o">:</span>
<span class="lineno">71 </span>    <span class="n">SampleViewWidget</span> <span class="o">*</span><span class="n">mViewWidget</span><span class="p">;</span>
<span class="lineno">72 </span>
<span class="lineno">73 </span>    <span class="n">QString</span> <span class="n">mFileName</span><span class="p">;</span>
<span class="lineno">74 </span><span class="p">};</span>
<span class="lineno">75 </span>
<span class="lineno">76 </span><span class="c1">//==============================================================================</span>
<span class="lineno">77 </span>
<span class="lineno">78 </span><span class="p">}</span> <span class="c1">// namespace SampleView</span>
<span class="lineno">79 </span><span class="p">}</span> <span class="c1">// namespace OpenCOR</span>
</pre></div>
</div>
<p>As mentioned above, our plugin implements some interfaces, which means that their header file is included (lines 28, 29, 31 and 32).
It also means that our plugin class inherits from those interfaces (lines 49-51), as well as makes calls to the <code class="docutils literal notranslate"><span class="pre">Q_INTERFACES()</span></code> macro to let <a class="reference external" href="https://qt.io/">Qt</a> know which interfaces it implements (lines 57-60).
Finally, we include the inline files (lines 65-68) that declare various methods that must be implemented by our plugin (see <a class="reference internal" href="#develop-plugins-sampleview-interfacesimplementation"><span class="std std-ref">below</span></a>).
(The rest of the class definition is specific to our plugin and is discussed <a class="reference internal" href="#develop-plugins-sampleview-pluginspecific"><span class="std std-ref">below</span></a>.)</p>
<p>The C function that is used by OpenCOR to retrieve some <a class="reference internal" href="index.html#develop-plugins-index-basicinformation"><span class="std std-ref">basic information</span></a> about our plugin can be found in <a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleView/src/sampleviewplugin.cpp"><code class="docutils literal notranslate"><span class="pre">sampleviewplugin.cpp</span></code></a>:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="lineno">40 </span><span class="n">PLUGININFO_FUNC</span> <span class="nf">SampleViewPluginInfo</span><span class="p">()</span>
<span class="lineno">41 </span><span class="p">{</span>
<span class="lineno">42 </span>    <span class="k">static</span> <span class="k">const</span> <span class="n">Descriptions</span> <span class="n">descriptions</span> <span class="o">=</span> <span class="p">{</span>
<span class="lineno">43 </span>                                                 <span class="p">{</span> <span class="s">&quot;en&quot;</span><span class="p">,</span> <span class="n">QString</span><span class="o">::</span><span class="n">fromUtf8</span><span class="p">(</span><span class="s">&quot;a plugin that provides a test view.&quot;</span><span class="p">)</span> <span class="p">},</span>
<span class="lineno">44 </span>                                                 <span class="p">{</span> <span class="s">&quot;fr&quot;</span><span class="p">,</span> <span class="n">QString</span><span class="o">::</span><span class="n">fromUtf8</span><span class="p">(</span><span class="s">&quot;une extension qui fournit une vue de test.&quot;</span><span class="p">)</span> <span class="p">}</span>
<span class="lineno">45 </span>                                             <span class="p">};</span>
<span class="lineno">46 </span>
<span class="lineno">47 </span>    <span class="k">return</span> <span class="k">new</span> <span class="n">PluginInfo</span><span class="p">(</span><span class="n">PluginInfo</span><span class="o">::</span><span class="n">Category</span><span class="o">::</span><span class="n">Sample</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span>
<span class="lineno">48 </span>                          <span class="p">{</span> <span class="s">&quot;Core&quot;</span> <span class="p">},</span>
<span class="lineno">49 </span>                          <span class="n">descriptions</span><span class="p">);</span>
<span class="lineno">50 </span><span class="p">}</span>
</pre></div>
</div>
<p>As can be seen, our plugin is selectable by the user, but it does not offer <a class="reference external" href="https://en.wikipedia.org/wiki/Command-line_interface">CLI</a> support (line 47).
It also has a direct dependency on the <a class="reference external" href="https://github.com/opencor/opencor/tree/master/src/plugins/miscellaneous/Core/">Core</a> plugin (line 48).</p>
</section>
<section id="interfaces-implementation">
<span id="develop-plugins-sampleview-interfacesimplementation"></span><h2>Interfaces implementation<a class="headerlink" href="#interfaces-implementation" title="Permalink to this heading">¶</a></h2>
<p>The implementation of the interfaces’ various methods can be found in <a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleView/src/sampleviewplugin.cpp"><code class="docutils literal notranslate"><span class="pre">sampleviewplugin.cpp</span></code></a>.
The methods are grouped by interface and are ordered alphabetically.</p>
<p>We start with the <a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/filehandlinginterface.inl">File handling</a> interface:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="lineno"> 60 </span><span class="c1">//==============================================================================</span>
<span class="lineno"> 61 </span><span class="c1">// File handling interface</span>
<span class="lineno"> 62 </span><span class="c1">//==============================================================================</span>
<span class="lineno"> 63 </span>
<span class="lineno"> 64 </span><span class="kt">bool</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">importFile</span><span class="p">(</span><span class="k">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pFileName</span><span class="p">)</span>
<span class="lineno"> 65 </span><span class="p">{</span>
<span class="lineno"> 66 </span>    <span class="n">Q_UNUSED</span><span class="p">(</span><span class="n">pFileName</span><span class="p">)</span>
<span class="lineno"> 67 </span>
<span class="lineno"> 68 </span>    <span class="c1">// We don&#39;t handle this interface...</span>
<span class="lineno"> 69 </span>
<span class="lineno"> 70 </span>    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="lineno"> 71 </span><span class="p">}</span>
<span class="lineno"> 72 </span>
<span class="lineno"> 73 </span><span class="c1">//==============================================================================</span>
<span class="lineno"> 74 </span>
<span class="lineno"> 75 </span><span class="kt">bool</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">saveFile</span><span class="p">(</span><span class="k">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pOldFileName</span><span class="p">,</span>
<span class="lineno"> 76 </span>                                <span class="k">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pNewFileName</span><span class="p">,</span>
<span class="lineno"> 77 </span>                                <span class="kt">bool</span> <span class="o">&amp;</span><span class="n">pNeedFeedback</span><span class="p">)</span>
<span class="lineno"> 78 </span><span class="p">{</span>
<span class="lineno"> 79 </span>    <span class="n">Q_UNUSED</span><span class="p">(</span><span class="n">pOldFileName</span><span class="p">)</span>
<span class="lineno"> 80 </span>    <span class="n">Q_UNUSED</span><span class="p">(</span><span class="n">pNewFileName</span><span class="p">)</span>
<span class="lineno"> 81 </span>    <span class="n">Q_UNUSED</span><span class="p">(</span><span class="n">pNeedFeedback</span><span class="p">)</span>
<span class="lineno"> 82 </span>
<span class="lineno"> 83 </span>    <span class="c1">// We don&#39;t handle this interface...</span>
<span class="lineno"> 84 </span>
<span class="lineno"> 85 </span>    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="lineno"> 86 </span><span class="p">}</span>
<span class="lineno"> 87 </span>
<span class="lineno"> 88 </span><span class="c1">//==============================================================================</span>
<span class="lineno"> 89 </span>
<span class="lineno"> 90 </span><span class="kt">void</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">fileOpened</span><span class="p">(</span><span class="k">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pFileName</span><span class="p">)</span>
<span class="lineno"> 91 </span><span class="p">{</span>
<span class="lineno"> 92 </span>    <span class="n">Q_UNUSED</span><span class="p">(</span><span class="n">pFileName</span><span class="p">)</span>
<span class="lineno"> 93 </span>
<span class="lineno"> 94 </span>    <span class="c1">// We don&#39;t handle this interface...</span>
<span class="lineno"> 95 </span><span class="p">}</span>
<span class="lineno"> 96 </span>
<span class="lineno"> 97 </span><span class="c1">//==============================================================================</span>
<span class="lineno"> 98 </span>
<span class="lineno"> 99 </span><span class="kt">void</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">filePermissionsChanged</span><span class="p">(</span><span class="k">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pFileName</span><span class="p">)</span>
<span class="lineno">100 </span><span class="p">{</span>
<span class="lineno">101 </span>    <span class="c1">// The given file has had its permissions changed, so update our view</span>
<span class="lineno">102 </span>    <span class="c1">// widget, if needed</span>
<span class="lineno">103 </span>
<span class="lineno">104 </span>    <span class="k">if</span> <span class="p">(</span><span class="n">pFileName</span> <span class="o">==</span> <span class="n">mFileName</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">105 </span>        <span class="n">mViewWidget</span><span class="o">-&gt;</span><span class="n">update</span><span class="p">(</span><span class="n">pFileName</span><span class="p">);</span>
<span class="lineno">106 </span>    <span class="p">}</span>
<span class="lineno">107 </span><span class="p">}</span>
<span class="lineno">108 </span>
<span class="lineno">109 </span><span class="c1">//==============================================================================</span>
<span class="lineno">110 </span>
<span class="lineno">111 </span><span class="kt">void</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">fileModified</span><span class="p">(</span><span class="k">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pFileName</span><span class="p">)</span>
<span class="lineno">112 </span><span class="p">{</span>
<span class="lineno">113 </span>    <span class="n">Q_UNUSED</span><span class="p">(</span><span class="n">pFileName</span><span class="p">)</span>
<span class="lineno">114 </span>
<span class="lineno">115 </span>    <span class="c1">// We don&#39;t handle this interface...</span>
<span class="lineno">116 </span><span class="p">}</span>
<span class="lineno">117 </span>
<span class="lineno">118 </span><span class="c1">//==============================================================================</span>
<span class="lineno">119 </span>
<span class="lineno">120 </span><span class="kt">void</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">fileSaved</span><span class="p">(</span><span class="k">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pFileName</span><span class="p">)</span>
<span class="lineno">121 </span><span class="p">{</span>
<span class="lineno">122 </span>    <span class="n">Q_UNUSED</span><span class="p">(</span><span class="n">pFileName</span><span class="p">)</span>
<span class="lineno">123 </span>
<span class="lineno">124 </span>    <span class="c1">// We don&#39;t handle this interface...</span>
<span class="lineno">125 </span><span class="p">}</span>
<span class="lineno">126 </span>
<span class="lineno">127 </span><span class="c1">//==============================================================================</span>
<span class="lineno">128 </span>
<span class="lineno">129 </span><span class="kt">void</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">fileReloaded</span><span class="p">(</span><span class="k">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pFileName</span><span class="p">)</span>
<span class="lineno">130 </span><span class="p">{</span>
<span class="lineno">131 </span>    <span class="c1">// The given file has been reloaded, so update our view widget, if needed</span>
<span class="lineno">132 </span>
<span class="lineno">133 </span>    <span class="k">if</span> <span class="p">(</span><span class="n">pFileName</span> <span class="o">==</span> <span class="n">mFileName</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">134 </span>        <span class="n">mViewWidget</span><span class="o">-&gt;</span><span class="n">update</span><span class="p">(</span><span class="n">pFileName</span><span class="p">);</span>
<span class="lineno">135 </span>    <span class="p">}</span>
<span class="lineno">136 </span><span class="p">}</span>
<span class="lineno">137 </span>
<span class="lineno">138 </span><span class="c1">//==============================================================================</span>
<span class="lineno">139 </span>
<span class="lineno">140 </span><span class="kt">void</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">fileRenamed</span><span class="p">(</span><span class="k">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pOldFileName</span><span class="p">,</span>
<span class="lineno">141 </span>                                   <span class="k">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pNewFileName</span><span class="p">)</span>
<span class="lineno">142 </span><span class="p">{</span>
<span class="lineno">143 </span>    <span class="n">Q_UNUSED</span><span class="p">(</span><span class="n">pOldFileName</span><span class="p">)</span>
<span class="lineno">144 </span>
<span class="lineno">145 </span>    <span class="c1">// The given file has been renamed, so update our view widget, if needed</span>
<span class="lineno">146 </span>
<span class="lineno">147 </span>    <span class="k">if</span> <span class="p">(</span><span class="n">pOldFileName</span> <span class="o">==</span> <span class="n">mFileName</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">148 </span>        <span class="n">mFileName</span> <span class="o">=</span> <span class="n">pNewFileName</span><span class="p">;</span>
<span class="lineno">149 </span>
<span class="lineno">150 </span>        <span class="n">mViewWidget</span><span class="o">-&gt;</span><span class="n">update</span><span class="p">(</span><span class="n">pNewFileName</span><span class="p">);</span>
<span class="lineno">151 </span>    <span class="p">}</span>
<span class="lineno">152 </span><span class="p">}</span>
<span class="lineno">153 </span>
<span class="lineno">154 </span><span class="c1">//==============================================================================</span>
<span class="lineno">155 </span>
<span class="lineno">156 </span><span class="kt">void</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">fileClosed</span><span class="p">(</span><span class="k">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pFileName</span><span class="p">)</span>
<span class="lineno">157 </span><span class="p">{</span>
<span class="lineno">158 </span>    <span class="c1">// The given file has been closed, so update our internals, if needed</span>
<span class="lineno">159 </span>
<span class="lineno">160 </span>    <span class="k">if</span> <span class="p">(</span><span class="n">pFileName</span> <span class="o">==</span> <span class="n">mFileName</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">161 </span>        <span class="n">mFileName</span> <span class="o">=</span> <span class="n">QString</span><span class="p">();</span>
<span class="lineno">162 </span>    <span class="p">}</span>
<span class="lineno">163 </span><span class="p">}</span>
<span class="lineno">164 </span>
<span class="lineno">165 </span><span class="c1">//==============================================================================</span>
</pre></div>
</div>
<p>Our plugin provides a view and, as such, should at least handle some of the <a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/filehandlinginterface.inl">File handling</a> interface’s methods.
Here, we want our plugin to provide some information about the current file, so we do not need to implement <code class="docutils literal notranslate"><span class="pre">importFile()</span></code> (lines 64-71) <code class="docutils literal notranslate"><span class="pre">saveFile()</span></code> (lines 75-86), <code class="docutils literal notranslate"><span class="pre">fileOpened()</span></code> (lines 90-95), <code class="docutils literal notranslate"><span class="pre">fileModified()</span></code> (lines 111-116) and <code class="docutils literal notranslate"><span class="pre">fileSaved()</span></code> (lines 120-125).
On the other hand, should the current file have its permissions changed or be renamed, then we want to update the information presented in our view.
We do this by implementing the <code class="docutils literal notranslate"><span class="pre">filePermissionsChanged()</span></code> (lines 99-107) and <code class="docutils literal notranslate"><span class="pre">fileReloaded()</span></code> (lines 129-136) methods.
The same holds true if the current file gets renamed, in which case we also want to update <code class="docutils literal notranslate"><span class="pre">mFileName</span></code> (see <code class="docutils literal notranslate"><span class="pre">fileRenamed()</span></code>; lines 140-152).
Finally, we want to reset <code class="docutils literal notranslate"><span class="pre">mFileName</span></code> if the current file gets closed (see <code class="docutils literal notranslate"><span class="pre">fileClosed()</span></code>; lines 156-163).</p>
<p>Next, we have the <a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/i18ninterface.inl">Internationalisation</a> interface:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="lineno">165 </span><span class="c1">//==============================================================================</span>
<span class="lineno">166 </span><span class="c1">// I18n interface</span>
<span class="lineno">167 </span><span class="c1">//==============================================================================</span>
<span class="lineno">168 </span>
<span class="lineno">169 </span><span class="kt">void</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">retranslateUi</span><span class="p">()</span>
<span class="lineno">170 </span><span class="p">{</span>
<span class="lineno">171 </span>    <span class="c1">// Retranslate our view widget, if needed</span>
<span class="lineno">172 </span>
<span class="lineno">173 </span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">mFileName</span><span class="p">.</span><span class="n">isEmpty</span><span class="p">())</span> <span class="p">{</span>
<span class="lineno">174 </span>        <span class="n">mViewWidget</span><span class="o">-&gt;</span><span class="n">retranslateUi</span><span class="p">();</span>
<span class="lineno">175 </span>    <span class="p">}</span>
<span class="lineno">176 </span><span class="p">}</span>
<span class="lineno">177 </span>
<span class="lineno">178 </span><span class="c1">//==============================================================================</span>
</pre></div>
</div>
<p>If some information is being shown for a file, then we ask our view to retranslate itself.</p>
<p>After the <a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/i18ninterface.inl">Internationalisation</a> interface, we have the <a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/plugininterface.inl">Plugin</a> interface:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="lineno">178 </span><span class="c1">//==============================================================================</span>
<span class="lineno">179 </span><span class="c1">// Plugin interface</span>
<span class="lineno">180 </span><span class="c1">//==============================================================================</span>
<span class="lineno">181 </span>
<span class="lineno">182 </span><span class="kt">bool</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">definesPluginInterfaces</span><span class="p">()</span>
<span class="lineno">183 </span><span class="p">{</span>
<span class="lineno">184 </span>    <span class="c1">// We don&#39;t handle this interface...</span>
<span class="lineno">185 </span>
<span class="lineno">186 </span>    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="lineno">187 </span><span class="p">}</span>
<span class="lineno">188 </span>
<span class="lineno">189 </span><span class="c1">//==============================================================================</span>
<span class="lineno">190 </span>
<span class="lineno">191 </span><span class="kt">bool</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">pluginInterfacesOk</span><span class="p">(</span><span class="k">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pFileName</span><span class="p">,</span>
<span class="lineno">192 </span>                                          <span class="n">QObject</span> <span class="o">*</span><span class="n">pInstance</span><span class="p">)</span>
<span class="lineno">193 </span><span class="p">{</span>
<span class="lineno">194 </span>    <span class="n">Q_UNUSED</span><span class="p">(</span><span class="n">pFileName</span><span class="p">)</span>
<span class="lineno">195 </span>    <span class="n">Q_UNUSED</span><span class="p">(</span><span class="n">pInstance</span><span class="p">)</span>
<span class="lineno">196 </span>
<span class="lineno">197 </span>    <span class="c1">// We don&#39;t handle this interface...</span>
<span class="lineno">198 </span>
<span class="lineno">199 </span>    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="lineno">200 </span><span class="p">}</span>
<span class="lineno">201 </span>
<span class="lineno">202 </span><span class="c1">//==============================================================================</span>
<span class="lineno">203 </span>
<span class="lineno">204 </span><span class="kt">void</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">initializePlugin</span><span class="p">()</span>
<span class="lineno">205 </span><span class="p">{</span>
<span class="lineno">206 </span>    <span class="c1">// Create our Sample view widget</span>
<span class="lineno">207 </span>
<span class="lineno">208 </span>    <span class="n">mViewWidget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SampleViewWidget</span><span class="p">(</span><span class="n">Core</span><span class="o">::</span><span class="n">mainWindow</span><span class="p">());</span>
<span class="lineno">209 </span>
<span class="lineno">210 </span>    <span class="c1">// Hide our Sample view widget since it may not initially be shown in our</span>
<span class="lineno">211 </span>    <span class="c1">// central widget</span>
<span class="lineno">212 </span>
<span class="lineno">213 </span>    <span class="n">mViewWidget</span><span class="o">-&gt;</span><span class="n">setVisible</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
<span class="lineno">214 </span><span class="p">}</span>
<span class="lineno">215 </span>
<span class="lineno">216 </span><span class="c1">//==============================================================================</span>
<span class="lineno">217 </span>
<span class="lineno">218 </span><span class="kt">void</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">finalizePlugin</span><span class="p">()</span>
<span class="lineno">219 </span><span class="p">{</span>
<span class="lineno">220 </span>    <span class="c1">// We don&#39;t handle this interface...</span>
<span class="lineno">221 </span><span class="p">}</span>
<span class="lineno">222 </span>
<span class="lineno">223 </span><span class="c1">//==============================================================================</span>
<span class="lineno">224 </span>
<span class="lineno">225 </span><span class="kt">void</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">pluginsInitialized</span><span class="p">(</span><span class="k">const</span> <span class="n">Plugins</span> <span class="o">&amp;</span><span class="n">pLoadedPlugins</span><span class="p">)</span>
<span class="lineno">226 </span><span class="p">{</span>
<span class="lineno">227 </span>    <span class="n">Q_UNUSED</span><span class="p">(</span><span class="n">pLoadedPlugins</span><span class="p">)</span>
<span class="lineno">228 </span>
<span class="lineno">229 </span>    <span class="c1">// We don&#39;t handle this interface...</span>
<span class="lineno">230 </span><span class="p">}</span>
<span class="lineno">231 </span>
<span class="lineno">232 </span><span class="c1">//==============================================================================</span>
<span class="lineno">233 </span>
<span class="lineno">234 </span><span class="kt">void</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">loadSettings</span><span class="p">(</span><span class="n">QSettings</span> <span class="o">&amp;</span><span class="n">pSettings</span><span class="p">)</span>
<span class="lineno">235 </span><span class="p">{</span>
<span class="lineno">236 </span>    <span class="n">Q_UNUSED</span><span class="p">(</span><span class="n">pSettings</span><span class="p">)</span>
<span class="lineno">237 </span>
<span class="lineno">238 </span>    <span class="c1">// We don&#39;t handle this interface...</span>
<span class="lineno">239 </span><span class="p">}</span>
<span class="lineno">240 </span>
<span class="lineno">241 </span><span class="c1">//==============================================================================</span>
<span class="lineno">242 </span>
<span class="lineno">243 </span><span class="kt">void</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">saveSettings</span><span class="p">(</span><span class="n">QSettings</span> <span class="o">&amp;</span><span class="n">pSettings</span><span class="p">)</span> <span class="k">const</span>
<span class="lineno">244 </span><span class="p">{</span>
<span class="lineno">245 </span>    <span class="n">Q_UNUSED</span><span class="p">(</span><span class="n">pSettings</span><span class="p">)</span>
<span class="lineno">246 </span>
<span class="lineno">247 </span>    <span class="c1">// We don&#39;t handle this interface...</span>
<span class="lineno">248 </span><span class="p">}</span>
<span class="lineno">249 </span>
<span class="lineno">250 </span><span class="c1">//==============================================================================</span>
<span class="lineno">251 </span>
<span class="lineno">252 </span><span class="kt">void</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">handleUrl</span><span class="p">(</span><span class="k">const</span> <span class="n">QUrl</span> <span class="o">&amp;</span><span class="n">pUrl</span><span class="p">)</span>
<span class="lineno">253 </span><span class="p">{</span>
<span class="lineno">254 </span>    <span class="n">Q_UNUSED</span><span class="p">(</span><span class="n">pUrl</span><span class="p">)</span>
<span class="lineno">255 </span>
<span class="lineno">256 </span>    <span class="c1">// We don&#39;t handle this interface...</span>
<span class="lineno">257 </span><span class="p">}</span>
<span class="lineno">258 </span>
<span class="lineno">259 </span><span class="c1">//==============================================================================</span>
</pre></div>
</div>
<p>The only method of interest to our plugin is <code class="docutils literal notranslate"><span class="pre">initializePlugin()</span></code> (lines 204-214), which is where we initialise <code class="docutils literal notranslate"><span class="pre">mViewWidget</span></code>, our view.
All the other methods (<code class="docutils literal notranslate"><span class="pre">definesPluginInterfaces()</span></code>, <code class="docutils literal notranslate"><span class="pre">pluginInterfacesOk()</span></code>, <code class="docutils literal notranslate"><span class="pre">finalizePlugin()</span></code>, <code class="docutils literal notranslate"><span class="pre">pluginsInitialized()</span></code>, <code class="docutils literal notranslate"><span class="pre">loadSettings()</span></code>, <code class="docutils literal notranslate"><span class="pre">saveSettings()</span></code> and <code class="docutils literal notranslate"><span class="pre">handleUrl()</span></code>) are left empty.</p>
<p>Finally, we have the <a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/viewinterface.inl">View</a> interface:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="lineno">259 </span><span class="c1">//==============================================================================</span>
<span class="lineno">260 </span><span class="c1">// View interface</span>
<span class="lineno">261 </span><span class="c1">//==============================================================================</span>
<span class="lineno">262 </span>
<span class="lineno">263 </span><span class="n">ViewInterface</span><span class="o">::</span><span class="n">Mode</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">viewMode</span><span class="p">()</span> <span class="k">const</span>
<span class="lineno">264 </span><span class="p">{</span>
<span class="lineno">265 </span>    <span class="c1">// Return our mode</span>
<span class="lineno">266 </span>
<span class="lineno">267 </span>    <span class="k">return</span> <span class="n">ViewInterface</span><span class="o">::</span><span class="n">Mode</span><span class="o">::</span><span class="n">Sample</span><span class="p">;</span>
<span class="lineno">268 </span><span class="p">}</span>
<span class="lineno">269 </span>
<span class="lineno">270 </span><span class="c1">//==============================================================================</span>
<span class="lineno">271 </span>
<span class="lineno">272 </span><span class="n">QStringList</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">viewMimeTypes</span><span class="p">()</span> <span class="k">const</span>
<span class="lineno">273 </span><span class="p">{</span>
<span class="lineno">274 </span>    <span class="c1">// Return the MIME types we support, i.e. any in our case</span>
<span class="lineno">275 </span>
<span class="lineno">276 </span>    <span class="k">return</span> <span class="p">{};</span>
<span class="lineno">277 </span><span class="p">}</span>
<span class="lineno">278 </span>
<span class="lineno">279 </span><span class="c1">//==============================================================================</span>
<span class="lineno">280 </span>
<span class="lineno">281 </span><span class="n">QString</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">viewMimeType</span><span class="p">(</span><span class="k">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pFileName</span><span class="p">)</span> <span class="k">const</span>
<span class="lineno">282 </span><span class="p">{</span>
<span class="lineno">283 </span>    <span class="n">Q_UNUSED</span><span class="p">(</span><span class="n">pFileName</span><span class="p">)</span>
<span class="lineno">284 </span>
<span class="lineno">285 </span>    <span class="c1">// Return the MIME type for the given file</span>
<span class="lineno">286 </span>
<span class="lineno">287 </span>    <span class="k">return</span> <span class="p">{};</span>
<span class="lineno">288 </span><span class="p">}</span>
<span class="lineno">289 </span>
<span class="lineno">290 </span><span class="c1">//==============================================================================</span>
<span class="lineno">291 </span>
<span class="lineno">292 </span><span class="n">QString</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">viewDefaultFileExtension</span><span class="p">()</span> <span class="k">const</span>
<span class="lineno">293 </span><span class="p">{</span>
<span class="lineno">294 </span>    <span class="c1">// Return the default file extension we support</span>
<span class="lineno">295 </span>
<span class="lineno">296 </span>    <span class="k">return</span> <span class="p">{};</span>
<span class="lineno">297 </span><span class="p">}</span>
<span class="lineno">298 </span>
<span class="lineno">299 </span><span class="c1">//==============================================================================</span>
<span class="lineno">300 </span>
<span class="lineno">301 </span><span class="n">QWidget</span> <span class="o">*</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">viewWidget</span><span class="p">(</span><span class="k">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pFileName</span><span class="p">)</span>
<span class="lineno">302 </span><span class="p">{</span>
<span class="lineno">303 </span>    <span class="c1">// Update and return our Sample view widget using the given file</span>
<span class="lineno">304 </span>
<span class="lineno">305 </span>    <span class="n">mFileName</span> <span class="o">=</span> <span class="n">pFileName</span><span class="p">;</span>
<span class="lineno">306 </span>
<span class="lineno">307 </span>    <span class="n">mViewWidget</span><span class="o">-&gt;</span><span class="n">update</span><span class="p">(</span><span class="n">pFileName</span><span class="p">);</span>
<span class="lineno">308 </span>
<span class="lineno">309 </span>    <span class="k">return</span> <span class="n">mViewWidget</span><span class="p">;</span>
<span class="lineno">310 </span><span class="p">}</span>
<span class="lineno">311 </span>
<span class="lineno">312 </span><span class="c1">//==============================================================================</span>
<span class="lineno">313 </span>
<span class="lineno">314 </span><span class="kt">void</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">removeViewWidget</span><span class="p">(</span><span class="k">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pFileName</span><span class="p">)</span>
<span class="lineno">315 </span><span class="p">{</span>
<span class="lineno">316 </span>    <span class="n">Q_UNUSED</span><span class="p">(</span><span class="n">pFileName</span><span class="p">)</span>
<span class="lineno">317 </span>
<span class="lineno">318 </span>    <span class="c1">// Reset our internals</span>
<span class="lineno">319 </span>
<span class="lineno">320 </span>    <span class="n">mFileName</span> <span class="o">=</span> <span class="n">QString</span><span class="p">();</span>
<span class="lineno">321 </span><span class="p">}</span>
<span class="lineno">322 </span>
<span class="lineno">323 </span><span class="c1">//==============================================================================</span>
<span class="lineno">324 </span>
<span class="lineno">325 </span><span class="n">QString</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">viewName</span><span class="p">()</span> <span class="k">const</span>
<span class="lineno">326 </span><span class="p">{</span>
<span class="lineno">327 </span>    <span class="c1">// Return our Sample view&#39;s name</span>
<span class="lineno">328 </span>
<span class="lineno">329 </span>    <span class="k">return</span> <span class="n">tr</span><span class="p">(</span><span class="s">&quot;Sample&quot;</span><span class="p">);</span>
<span class="lineno">330 </span><span class="p">}</span>
<span class="lineno">331 </span>
<span class="lineno">332 </span><span class="c1">//==============================================================================</span>
<span class="lineno">333 </span>
<span class="lineno">334 </span><span class="n">QIcon</span> <span class="n">SampleViewPlugin</span><span class="o">::</span><span class="n">fileTabIcon</span><span class="p">(</span><span class="k">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pFileName</span><span class="p">)</span> <span class="k">const</span>
<span class="lineno">335 </span><span class="p">{</span>
<span class="lineno">336 </span>    <span class="n">Q_UNUSED</span><span class="p">(</span><span class="n">pFileName</span><span class="p">)</span>
<span class="lineno">337 </span>
<span class="lineno">338 </span>    <span class="c1">// We don&#39;t handle this interface...</span>
<span class="lineno">339 </span>
<span class="lineno">340 </span>    <span class="k">return</span> <span class="p">{};</span>
<span class="lineno">341 </span><span class="p">}</span>
<span class="lineno">342 </span>
<span class="lineno">343 </span><span class="c1">//==============================================================================</span>
</pre></div>
</div>
<p>Our plugin provides a view, so OpenCOR needs to know about its name (see <code class="docutils literal notranslate"><span class="pre">viewName()</span></code>; lines 325-330), its type (see <code class="docutils literal notranslate"><span class="pre">viewMode()</span></code>; lines 263-268), the MIME types it supports (see <code class="docutils literal notranslate"><span class="pre">viewMimeTypes()</span></code>; lines 272-277), the MIME type supported by a given file (see <code class="docutils literal notranslate"><span class="pre">viewMimeType()</span></code>; lines 281-288), the default file extension it supports (see <code class="docutils literal notranslate"><span class="pre">viewDefaultFileExtension()</span></code>; lines 292-297) and whether it needs a special tab icon (see <code class="docutils literal notranslate"><span class="pre">fileTabIcon()</span></code>; lines 334-341).
OpenCOR also needs to know the widget that is used for the view and this for a given file (see <code class="docutils literal notranslate"><span class="pre">viewWidget()</span></code>; lines 301-310).
Note that our plugin uses only one view widget (and updates its contents based on the file that is currently active), but it might perfectly use one per file.
Finally, our plugin needs to handle the case where a view widget is to be removed (see <code class="docutils literal notranslate"><span class="pre">removeViewWidget()</span></code>; lines 314-321), which happens whenever a file gets closed.</p>
</section>
<section id="plugin-specific">
<span id="develop-plugins-sampleview-pluginspecific"></span><h2>Plugin specific<a class="headerlink" href="#plugin-specific" title="Permalink to this heading">¶</a></h2>
<p>Some extra work is needed to get our plugin to do what we want, and this is done via the <code class="docutils literal notranslate"><span class="pre">SampleViewWidget</span></code> class in <a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleView/src/sampleviewwidget.h"><code class="docutils literal notranslate"><span class="pre">sampleviewwidget.h</span></code></a>:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="lineno">28 </span><span class="cp">#include</span> <span class="cpf">&quot;viewwidget.h&quot;</span><span class="cp"></span>
<span class="lineno">29 </span>
<span class="lineno">30 </span><span class="c1">//==============================================================================</span>
<span class="lineno">31 </span>
<span class="lineno">32 </span><span class="k">namespace</span> <span class="n">Ui</span> <span class="p">{</span>
<span class="lineno">33 </span>    <span class="k">class</span> <span class="nc">SampleViewWidget</span><span class="p">;</span>
<span class="lineno">34 </span><span class="p">}</span> <span class="c1">// namespace Ui</span>
<span class="lineno">35 </span>
<span class="lineno">36 </span><span class="c1">//==============================================================================</span>
<span class="lineno">37 </span>
<span class="lineno">38 </span><span class="k">namespace</span> <span class="n">OpenCOR</span> <span class="p">{</span>
<span class="lineno">39 </span><span class="k">namespace</span> <span class="n">SampleView</span> <span class="p">{</span>
<span class="lineno">40 </span>
<span class="lineno">41 </span><span class="c1">//==============================================================================</span>
<span class="lineno">42 </span>
<span class="lineno">43 </span><span class="k">class</span> <span class="nc">SampleViewWidget</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Core</span><span class="o">::</span><span class="n">ViewWidget</span>
<span class="lineno">44 </span><span class="p">{</span>
<span class="lineno">45 </span>    <span class="n">Q_OBJECT</span>
<span class="lineno">46 </span>
<span class="lineno">47 </span><span class="k">public</span><span class="o">:</span>
<span class="lineno">48 </span>    <span class="k">explicit</span> <span class="n">SampleViewWidget</span><span class="p">(</span><span class="n">QWidget</span> <span class="o">*</span><span class="n">pParent</span><span class="p">);</span>
<span class="lineno">49 </span>    <span class="o">~</span><span class="n">SampleViewWidget</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
<span class="lineno">50 </span>
<span class="lineno">51 </span>    <span class="kt">void</span> <span class="nf">retranslateUi</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
<span class="lineno">52 </span>
<span class="lineno">53 </span>    <span class="n">QWidget</span> <span class="o">*</span> <span class="nf">widget</span><span class="p">(</span><span class="k">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pFileName</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
<span class="lineno">54 </span>
<span class="lineno">55 </span>    <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="k">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pFileName</span><span class="p">);</span>
<span class="lineno">56 </span>
<span class="lineno">57 </span><span class="k">private</span><span class="o">:</span>
<span class="lineno">58 </span>    <span class="n">Ui</span><span class="o">::</span><span class="n">SampleViewWidget</span> <span class="o">*</span><span class="n">mGui</span><span class="p">;</span>
<span class="lineno">59 </span>
<span class="lineno">60 </span>    <span class="n">QString</span> <span class="n">mFileName</span><span class="p">;</span>
<span class="lineno">61 </span><span class="p">};</span>
<span class="lineno">62 </span>
<span class="lineno">63 </span><span class="c1">//==============================================================================</span>
<span class="lineno">64 </span>
<span class="lineno">65 </span><span class="p">}</span> <span class="c1">// namespace SampleView</span>
<span class="lineno">66 </span><span class="p">}</span> <span class="c1">// namespace OpenCOR</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">SampleViewWidget</span></code> inherits from <code class="docutils literal notranslate"><span class="pre">Core::ViewWidget</span></code>, which is defined in the <a class="reference external" href="https://github.com/opencor/opencor/tree/master/src/plugins/miscellaneous/Core/">Core</a> plugin and is an extended version of <a class="reference external" href="https://qt.io/">Qt</a>’s <code class="docutils literal notranslate"><span class="pre">QWidget</span></code> class (line 43).
It requires implementing the <code class="docutils literal notranslate"><span class="pre">widget()</span></code> method, which purpose is to return the widget that is to be shown in the view (line 53).
In the present case, it is <code class="docutils literal notranslate"><span class="pre">SampleViewWidget</span></code> itself.
Otherwise, <code class="docutils literal notranslate"><span class="pre">SampleViewWidget</span></code> also comes with a GUI file, which describes the layout of our plugin window (<a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleView/src/sampleviewwidget.ui"><code class="docutils literal notranslate"><span class="pre">sampleviewwidget.ui</span></code></a>).
The <code class="docutils literal notranslate"><span class="pre">update()</span></code> method is used by our plugin to update the contents of our view using information about the given file (line 55).</p>
<p>The implementation of <code class="docutils literal notranslate"><span class="pre">SampleViewWidget</span></code> can be found in <a class="reference external" href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleView/src/sampleviewwidget.cpp"><code class="docutils literal notranslate"><span class="pre">sampleviewwidget.cpp</span></code></a>:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="lineno"> 24 </span><span class="cp">#include</span> <span class="cpf">&quot;corecliutils.h&quot;</span><span class="cp"></span>
<span class="lineno"> 25 </span><span class="cp">#include</span> <span class="cpf">&quot;filemanager.h&quot;</span><span class="cp"></span>
<span class="lineno"> 26 </span><span class="cp">#include</span> <span class="cpf">&quot;sampleviewwidget.h&quot;</span><span class="cp"></span>
<span class="lineno"> 27 </span>
<span class="lineno"> 28 </span><span class="c1">//==============================================================================</span>
<span class="lineno"> 29 </span>
<span class="lineno"> 30 </span><span class="cp">#include</span> <span class="cpf">&quot;ui_sampleviewwidget.h&quot;</span><span class="cp"></span>
<span class="lineno"> 31 </span>
<span class="lineno"> 32 </span><span class="c1">//==============================================================================</span>
<span class="lineno"> 33 </span>
<span class="lineno"> 34 </span><span class="cp">#include</span> <span class="cpf">&lt;QFile&gt;</span><span class="cp"></span>
<span class="lineno"> 35 </span>
<span class="lineno"> 36 </span><span class="c1">//==============================================================================</span>
<span class="lineno"> 37 </span>
<span class="lineno"> 38 </span><span class="k">namespace</span> <span class="n">OpenCOR</span> <span class="p">{</span>
<span class="lineno"> 39 </span><span class="k">namespace</span> <span class="n">SampleView</span> <span class="p">{</span>
<span class="lineno"> 40 </span>
<span class="lineno"> 41 </span><span class="c1">//==============================================================================</span>
<span class="lineno"> 42 </span>
<span class="lineno"> 43 </span><span class="n">SampleViewWidget</span><span class="o">::</span><span class="n">SampleViewWidget</span><span class="p">(</span><span class="n">QWidget</span> <span class="o">*</span><span class="n">pParent</span><span class="p">)</span> <span class="o">:</span>
<span class="lineno"> 44 </span>    <span class="n">ViewWidget</span><span class="p">(</span><span class="n">pParent</span><span class="p">),</span>
<span class="lineno"> 45 </span>    <span class="n">mGui</span><span class="p">(</span><span class="k">new</span> <span class="n">Ui</span><span class="o">::</span><span class="n">SampleViewWidget</span><span class="p">),</span>
<span class="lineno"> 46 </span>    <span class="n">mFileName</span><span class="p">(</span><span class="n">QString</span><span class="p">())</span>
<span class="lineno"> 47 </span><span class="p">{</span>
<span class="lineno"> 48 </span>    <span class="c1">// Delete the layout that comes with ViewWidget</span>
<span class="lineno"> 49 </span>
<span class="lineno"> 50 </span>    <span class="k">delete</span> <span class="n">layout</span><span class="p">();</span>
<span class="lineno"> 51 </span>
<span class="lineno"> 52 </span>    <span class="c1">// Set up the GUI</span>
<span class="lineno"> 53 </span>
<span class="lineno"> 54 </span>    <span class="n">mGui</span><span class="o">-&gt;</span><span class="n">setupUi</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="lineno"> 55 </span><span class="p">}</span>
<span class="lineno"> 56 </span>
<span class="lineno"> 57 </span><span class="c1">//==============================================================================</span>
<span class="lineno"> 58 </span>
<span class="lineno"> 59 </span><span class="n">SampleViewWidget</span><span class="o">::~</span><span class="n">SampleViewWidget</span><span class="p">()</span>
<span class="lineno"> 60 </span><span class="p">{</span>
<span class="lineno"> 61 </span>    <span class="c1">// Delete the GUI</span>
<span class="lineno"> 62 </span>
<span class="lineno"> 63 </span>    <span class="k">delete</span> <span class="n">mGui</span><span class="p">;</span>
<span class="lineno"> 64 </span><span class="p">}</span>
<span class="lineno"> 65 </span>
<span class="lineno"> 66 </span><span class="c1">//==============================================================================</span>
<span class="lineno"> 67 </span>
<span class="lineno"> 68 </span><span class="kt">void</span> <span class="n">SampleViewWidget</span><span class="o">::</span><span class="n">retranslateUi</span><span class="p">()</span>
<span class="lineno"> 69 </span><span class="p">{</span>
<span class="lineno"> 70 </span>    <span class="c1">// Retranslate our GUI</span>
<span class="lineno"> 71 </span>
<span class="lineno"> 72 </span>    <span class="n">mGui</span><span class="o">-&gt;</span><span class="n">retranslateUi</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="lineno"> 73 </span>
<span class="lineno"> 74 </span>    <span class="c1">// Update ourself too since some widgets will have been reset following the</span>
<span class="lineno"> 75 </span>    <span class="c1">// retranslation (e.g. mGui-&gt;fileNameValue)</span>
<span class="lineno"> 76 </span>
<span class="lineno"> 77 </span>    <span class="n">update</span><span class="p">(</span><span class="n">mFileName</span><span class="p">);</span>
<span class="lineno"> 78 </span><span class="p">}</span>
<span class="lineno"> 79 </span>
<span class="lineno"> 80 </span><span class="c1">//==============================================================================</span>
<span class="lineno"> 81 </span>
<span class="lineno"> 82 </span><span class="n">QWidget</span> <span class="o">*</span> <span class="n">SampleViewWidget</span><span class="o">::</span><span class="n">widget</span><span class="p">(</span><span class="k">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pFileName</span><span class="p">)</span>
<span class="lineno"> 83 </span><span class="p">{</span>
<span class="lineno"> 84 </span>    <span class="n">Q_UNUSED</span><span class="p">(</span><span class="n">pFileName</span><span class="p">)</span>
<span class="lineno"> 85 </span>
<span class="lineno"> 86 </span>    <span class="c1">// Return the requested (self) widget</span>
<span class="lineno"> 87 </span>
<span class="lineno"> 88 </span>    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="lineno"> 89 </span><span class="p">}</span>
<span class="lineno"> 90 </span>
<span class="lineno"> 91 </span><span class="c1">//==============================================================================</span>
<span class="lineno"> 92 </span>
<span class="lineno"> 93 </span><span class="kt">void</span> <span class="n">SampleViewWidget</span><span class="o">::</span><span class="n">update</span><span class="p">(</span><span class="k">const</span> <span class="n">QString</span> <span class="o">&amp;</span><span class="n">pFileName</span><span class="p">)</span>
<span class="lineno"> 94 </span><span class="p">{</span>
<span class="lineno"> 95 </span>    <span class="c1">// Keep track of the given file name</span>
<span class="lineno"> 96 </span>
<span class="lineno"> 97 </span>    <span class="n">mFileName</span> <span class="o">=</span> <span class="n">pFileName</span><span class="p">;</span>
<span class="lineno"> 98 </span>
<span class="lineno"> 99 </span>    <span class="c1">// Initialise our GUI with some information about the given file</span>
<span class="lineno">100 </span>
<span class="lineno">101 </span>    <span class="n">mGui</span><span class="o">-&gt;</span><span class="n">fileNameValue</span><span class="o">-&gt;</span><span class="n">setText</span><span class="p">(</span><span class="n">pFileName</span><span class="p">);</span>
<span class="lineno">102 </span>
<span class="lineno">103 </span>    <span class="n">Core</span><span class="o">::</span><span class="n">FileManager</span> <span class="o">*</span><span class="n">fileManagerInstance</span> <span class="o">=</span> <span class="n">Core</span><span class="o">::</span><span class="n">FileManager</span><span class="o">::</span><span class="n">instance</span><span class="p">();</span>
<span class="lineno">104 </span>
<span class="lineno">105 </span>    <span class="n">mGui</span><span class="o">-&gt;</span><span class="n">lockedValue</span><span class="o">-&gt;</span><span class="n">setText</span><span class="p">(</span><span class="n">fileManagerInstance</span><span class="o">-&gt;</span><span class="n">isLocked</span><span class="p">(</span><span class="n">pFileName</span><span class="p">)</span><span class="o">?</span><span class="n">tr</span><span class="p">(</span><span class="s">&quot;Yes&quot;</span><span class="p">)</span><span class="o">:</span><span class="n">tr</span><span class="p">(</span><span class="s">&quot;No&quot;</span><span class="p">));</span>
<span class="lineno">106 </span>
<span class="lineno">107 </span>    <span class="n">QString</span> <span class="n">sha1Value</span> <span class="o">=</span> <span class="n">fileManagerInstance</span><span class="o">-&gt;</span><span class="n">sha1</span><span class="p">(</span><span class="n">pFileName</span><span class="p">);</span>
<span class="lineno">108 </span>
<span class="lineno">109 </span>    <span class="n">mGui</span><span class="o">-&gt;</span><span class="n">sha1Value</span><span class="o">-&gt;</span><span class="n">setText</span><span class="p">(</span><span class="n">sha1Value</span><span class="p">.</span><span class="n">isEmpty</span><span class="p">()</span><span class="o">?</span><span class="s">&quot;???&quot;</span><span class="o">:</span><span class="n">sha1Value</span><span class="p">);</span>
<span class="lineno">110 </span>    <span class="n">mGui</span><span class="o">-&gt;</span><span class="n">sizeValue</span><span class="o">-&gt;</span><span class="n">setText</span><span class="p">(</span><span class="n">Core</span><span class="o">::</span><span class="n">sizeAsString</span><span class="p">(</span><span class="n">quint64</span><span class="p">(</span><span class="n">QFile</span><span class="p">(</span><span class="n">pFileName</span><span class="p">).</span><span class="n">size</span><span class="p">())));</span>
<span class="lineno">111 </span><span class="p">}</span>
<span class="lineno">112 </span>
<span class="lineno">113 </span><span class="c1">//==============================================================================</span>
<span class="lineno">114 </span>
<span class="lineno">115 </span><span class="p">}</span> <span class="c1">// namespace SampleView</span>
<span class="lineno">116 </span><span class="p">}</span> <span class="c1">// namespace OpenCOR</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">retranslateUi()</span></code> (lines 68-78) retranslates our view while <code class="docutils literal notranslate"><span class="pre">widget()</span></code> returns it (lines 82-89) and <code class="docutils literal notranslate"><span class="pre">update()</span></code> updates its contents (lines 93-111).</p>
</section>
</section>



        <script type="text/javascript">
            copyright("../../_static");
        </script>
    </body>
</html>